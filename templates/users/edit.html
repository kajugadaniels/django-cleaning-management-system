{% extends 'layouts/app.html' %}
{% load static %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <div class="card">
                <div class="card-body">
                    <div class="list-product-header">
                        <div class="d-flex justify-content-between">
                            <h4>Update a User</h4>
                            <a class="btn btn-primary" href="{% url 'base:getUsers' %}">
                                <i class="fa fa-eye"></i>
                                Go Back
                            </a>
                        </div>
                    </div>
                    <hr>
                    <div class="form theme-form">
                        <form class="price-wrapper" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-sm-4" id="div_role">
                                    <label class="form-label">Role</label>
                                    {{ form.role }}
                                </div>
                                <div class="col-sm-4" id="div_firstname" style="display: none;">
                                    <label class="form-label">First Name</label>
                                    {{ form.firstname }}
                                </div>
                                <div class="col-sm-4" id="div_lastname" style="display: none;">
                                    <label class="form-label">Last Name</label>
                                    {{ form.lastname }}
                                </div>
                                <div class="col-sm-4" id="div_company_name" style="display: none;">
                                    <label class="form-label">Company Name</label>
                                    {{ form.company_name }}
                                </div>
                                <div class="col-sm-4" id="div_email" style="display: none;">
                                    <label class="form-label">Email</label>
                                    {{ form.email }}
                                </div>
                                <div class="col-sm-4" id="div_gender" style="display: none;">
                                    <label class="form-label">Gender</label>
                                    {{ form.gender }}
                                </div>
                                <div class="col-sm-4" id="div_nid" style="display: none;">
                                    <label class="form-label">National ID</label>
                                    {{ form.nid }}
                                </div>
                                <div class="col-sm-4" id="div_dob" style="display: none;">
                                    <label class="form-label">DOB</label>
                                    {{ form.dob }}
                                </div>
                                <div class="col-sm-4" id="div_profession" style="display: none;">
                                    <label class="form-label">Profession</label>
                                    {{ form.profession }}
                                </div>
                                <div class="col-sm-4" id="div_address" style="display: none;">
                                    <label class="form-label">Address</label>
                                    {{ form.address }}
                                </div>
                                <div class="col-sm-4" id="div_phone_number" style="display: none;">
                                    <label class="form-label">Phone Number</label>
                                    {{ form.phone_number }}
                                </div>
                                <div class="col-sm-4" id="div_password" style="display: none;">
                                    <label class="form-label">Password</label>
                                    {{ form.password }}
                                </div>
                                <div class="col-sm-4" id="div_password_confirmation" style="display: none;">
                                    <label class="form-label">Password Confirmation</label>
                                    {{ form.password_confirmation }}
                                </div>
                                <div class="col-sm-4" id="div_image" style="display: none;">
                                    <label class="form-label">Profile Image</label>
                                    {{ form.image }}
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col">
                                    <div class="text-end">
                                        <button class="btn btn-primary me-3" type="submit">
                                            Update User
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const roleField = document.querySelector('#id_role');
        const firstnameField = document.getElementById('div_firstname');
        const lastnameField = document.getElementById('div_lastname');
        const companyNameField = document.getElementById('div_company_name');
        const emailField = document.getElementById('div_email');
        const genderField = document.getElementById('div_gender');
        const nidField = document.getElementById('div_nid');
        const dobField = document.getElementById('div_dob');
        const professionField = document.getElementById('div_profession');
        const addressField = document.getElementById('div_address');  // No longer hidden
        const phoneNumberField = document.getElementById('div_phone_number');
        const passwordField = document.getElementById('div_password');
        const passwordConfirmationField = document.getElementById('div_password_confirmation');
        const imageField = document.getElementById('div_image');
    
        /**
         * Function to hide all fields except role
         */
        function hideAllFields() {
            firstnameField.style.display = 'none';
            lastnameField.style.display = 'none';
            companyNameField.style.display = 'none';
            emailField.style.display = 'none';
            genderField.style.display = 'none';
            nidField.style.display = 'none';
            dobField.style.display = 'none';
            professionField.style.display = 'none';
            phoneNumberField.style.display = 'none';
            passwordField.style.display = 'none';
            passwordConfirmationField.style.display = 'none';
            imageField.style.display = 'none';
        }
    
        /**
         * Function to show fields based on selected role
         * @param {string} role - The selected user role.
         */
        function toggleFields(role) {
            hideAllFields();
            switch(role) {
                case 'Manager':
                case 'Supervisor':
                    firstnameField.style.display = 'block';
                    lastnameField.style.display = 'block';
                    emailField.style.display = 'block';
                    genderField.style.display = 'block';
                    nidField.style.display = 'block';
                    dobField.style.display = 'block';
                    phoneNumberField.style.display = 'block';
                    // passwordField.style.display = 'block';
                    // passwordConfirmationField.style.display = 'block';
                    imageField.style.display = 'block';
                    break;
                case 'Client':
                    companyNameField.style.display = 'block';
                    emailField.style.display = 'block';
                    addressField.style.display = 'block';  // Always visible for all roles
                    phoneNumberField.style.display = 'block';
                    // passwordField.style.display = 'block';
                    // passwordConfirmationField.style.display = 'block';
                    imageField.style.display = 'block';
                    break;
                case 'Cleaner':
                    firstnameField.style.display = 'block';
                    lastnameField.style.display = 'block';
                    emailField.style.display = 'block';
                    genderField.style.display = 'block';
                    nidField.style.display = 'block';
                    dobField.style.display = 'block';
                    professionField.style.display = 'block';
                    phoneNumberField.style.display = 'block';
                    // passwordField.style.display = 'block';
                    // passwordConfirmationField.style.display = 'block';
                    imageField.style.display = 'block';
                    break;
                default:
                    hideAllFields();
            }
        }
    
        // Initial state: hide all fields except role
        hideAllFields();
    
        // Event listener for role field changes
        roleField.addEventListener('change', function() {
            toggleFields(this.value);
            if (this.value === 'Client') {
                firstnameField.style.display = 'none';
                lastnameField.style.display = 'none';
            } else {
                companyNameField.style.display = 'none';
            }
        });
    
        // If the form is being re-rendered with existing data, retain the visibility based on selected role
        const initialRole = roleField.value;
        if (initialRole) {
            toggleFields(initialRole);
            if (initialRole === 'Client') {
                firstnameField.style.display = 'none';
                lastnameField.style.display = 'none';
            }
        }
    });    
</script>

{% endblock %}
